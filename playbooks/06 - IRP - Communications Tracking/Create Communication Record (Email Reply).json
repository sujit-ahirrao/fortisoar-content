{
    "@type": "Workflow",
    "triggerLimit": null,
    "name": "Create Communication Record (Email Reply)",
    "aliasName": null,
    "tag": null,
    "description": "Creates a record in the communications module based off a reply to a received email.",
    "isActive": true,
    "debug": false,
    "singleRecordExecution": false,
    "remoteExecutableFlag": false,
    "parameters": [],
    "synchronous": false,
    "collection": "\/api\/3\/workflow_collections\/d98add27-83c9-4f73-a370-16454398e317",
    "versions": [],
    "triggerStep": "\/api\/3\/workflow_steps\/485a7860-1871-4573-a8b1-a6c78f73f87c",
    "steps": [
        {
            "@type": "WorkflowStep",
            "name": "Include Email Thread",
            "description": null,
            "arguments": {
                "conditions": [
                    {
                        "option": "Yes",
                        "step_iri": "\/api\/3\/workflow_steps\/7041452c-22ed-49a1-b110-ee08ef6d695e",
                        "condition": "{{ vars.input.params.includeEmailThread is none }}",
                        "step_name": "Reply Email"
                    },
                    {
                        "option": "No",
                        "default": true,
                        "step_iri": "\/api\/3\/workflow_steps\/5a64d3c1-47ba-46ec-914e-8905e51df41b",
                        "step_name": "Reply With Email Thread"
                    }
                ]
            },
            "status": null,
            "top": "570",
            "left": "475",
            "stepType": "\/api\/3\/workflow_step_types\/12254cf5-5db7-4b1a-8cb1-3af081924b28",
            "group": null,
            "uuid": "20c32266-a204-4f04-b2e1-f4db7fc0bb9f"
        },
        {
            "@type": "WorkflowStep",
            "name": "Add Comment",
            "description": null,
            "arguments": {
                "resource": {
                    "type": "\/api\/3\/picklists\/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                    "people": [],
                    "content": "<p>No correlated records found for this communication.<\/p>",
                    "__replace": "",
                    "isImportant": false,
                    "communication": "[\"{{vars.input.records[0]['@id']}}\"]",
                    "peopleUpdated": false
                },
                "operation": "Overwrite",
                "collection": "\/api\/3\/comments",
                "__recommend": [],
                "fieldOperation": {
                    "recordTags": "Overwrite"
                },
                "step_variables": []
            },
            "status": null,
            "top": "435",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/2597053c-e718-44b4-8394-4d40fe26d357",
            "group": null,
            "uuid": "374a0d76-abe6-474c-a6b6-6c69ec401b53"
        },
        {
            "@type": "WorkflowStep",
            "name": "Is Correlated Records Present",
            "description": null,
            "arguments": {
                "conditions": [
                    {
                        "option": "Yes",
                        "step_iri": "\/api\/3\/workflow_steps\/d7c960bd-1ff3-4173-bc6c-a2d03baabdbd",
                        "condition": "{{ vars.steps.Get_Communication_Correlated_Records[0].communications | length > 0 }}",
                        "step_name": "Get Correlated Records IRI"
                    },
                    {
                        "option": "No",
                        "default": true,
                        "step_iri": "\/api\/3\/workflow_steps\/374a0d76-abe6-474c-a6b6-6c69ec401b53",
                        "step_name": "Add Comment"
                    }
                ]
            },
            "status": null,
            "top": "300",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/12254cf5-5db7-4b1a-8cb1-3af081924b28",
            "group": null,
            "uuid": "46046f17-57ec-4399-826c-eacfd0a51abe"
        },
        {
            "@type": "WorkflowStep",
            "name": "Start",
            "description": null,
            "arguments": {
                "route": "bc09fe65-1725-4395-ad8a-aec7011e8c53",
                "title": "Reply",
                "resources": [
                    "communication"
                ],
                "inputVariables": [
                    {
                        "name": "to",
                        "type": "boolean",
                        "label": "To",
                        "title": "Checkbox",
                        "usable": true,
                        "tooltip": "",
                        "dataType": "checkbox",
                        "formType": "checkbox",
                        "required": true,
                        "_expanded": true,
                        "mmdUpdate": true,
                        "collection": false,
                        "searchable": true,
                        "moduleField": "from",
                        "templateUrl": "app\/components\/form\/fields\/checkbox.html",
                        "defaultValue": null,
                        "lengthConstraint": false,
                        "allowedEncryption": false,
                        "allowedGridColumn": true,
                        "useRecordFieldDefault": true
                    },
                    {
                        "name": "cc",
                        "type": "string",
                        "label": "CC",
                        "tooltip": "",
                        "dataType": "text",
                        "formType": "text",
                        "required": false,
                        "_expanded": true,
                        "moduleField": "cc",
                        "_nameTouched": true,
                        "useRecordFieldDefault": true
                    },
                    {
                        "name": "bcc",
                        "type": "string",
                        "label": "BCC",
                        "tooltip": "",
                        "dataType": "text",
                        "formType": "text",
                        "required": false,
                        "_expanded": true,
                        "moduleField": "bcc",
                        "_nameTouched": true,
                        "useRecordFieldDefault": true
                    },
                    {
                        "name": "emailBody",
                        "type": "string",
                        "label": "Email Body",
                        "title": "Rich Text",
                        "usable": true,
                        "tooltip": "",
                        "dataType": "text",
                        "formType": "richtext",
                        "required": true,
                        "_expanded": true,
                        "mmdUpdate": true,
                        "collection": false,
                        "searchable": true,
                        "moduleField": "body",
                        "templateUrl": "app\/components\/form\/fields\/richtext.html",
                        "defaultValue": null,
                        "lengthConstraint": false,
                        "allowedEncryption": true,
                        "allowedGridColumn": true,
                        "useRecordFieldDefault": false
                    },
                    {
                        "name": "includeEmailThread",
                        "type": "boolean",
                        "label": "Include Email Thread",
                        "title": "Checkbox",
                        "usable": true,
                        "tooltip": "",
                        "dataType": "checkbox",
                        "formType": "checkbox",
                        "required": false,
                        "_expanded": true,
                        "mmdUpdate": true,
                        "collection": false,
                        "searchable": true,
                        "templateUrl": "app\/components\/form\/fields\/checkbox.html",
                        "defaultValue": true,
                        "lengthConstraint": false,
                        "allowedEncryption": false,
                        "allowedGridColumn": true,
                        "useRecordFieldDefault": false
                    },
                    {
                        "name": "file",
                        "type": "string",
                        "label": "File",
                        "title": "File Field",
                        "usable": true,
                        "tooltip": "",
                        "dataType": "file",
                        "formType": "file",
                        "required": false,
                        "_expanded": true,
                        "mmdUpdate": true,
                        "collection": false,
                        "dataSource": {
                            "model": "files"
                        },
                        "searchable": false,
                        "templateUrl": "app\/components\/form\/fields\/file.html",
                        "defaultValue": null,
                        "lengthConstraint": true,
                        "allowedEncryption": false,
                        "allowedGridColumn": true,
                        "useRecordFieldDefault": false
                    }
                ],
                "step_variables": {
                    "input": {
                        "params": {
                            "cc": "{{vars.request.data[\"cc\"]}}",
                            "to": "{{vars.request.data[\"to\"]}}",
                            "bcc": "{{vars.request.data[\"bcc\"]}}",
                            "file": "{{vars.request.data[\"file\"]}}",
                            "emailBody": "{{vars.request.data[\"emailBody\"]}}",
                            "includeEmailThread": "{{vars.request.data[\"includeEmailThread\"]}}"
                        },
                        "records": "{{vars.input.records}}"
                    }
                },
                "_promptexpanded": true,
                "displayConditions": {
                    "communication": {
                        "sort": [],
                        "limit": 30,
                        "logic": "AND",
                        "filters": [
                            {
                                "type": "object",
                                "field": "msgDirection",
                                "value": "\/api\/3\/picklists\/c89f8eb7-0669-4535-9935-888ff46f544f",
                                "_value": {
                                    "@id": "\/api\/3\/picklists\/c89f8eb7-0669-4535-9935-888ff46f544f",
                                    "itemValue": "Received"
                                },
                                "operator": "eq"
                            }
                        ]
                    }
                },
                "executeButtonText": "Reply",
                "noRecordExecution": false,
                "singleRecordExecution": true
            },
            "status": null,
            "top": "30",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/f414d039-bb0d-4e59-9c39-a8f1e880b18a",
            "group": null,
            "uuid": "485a7860-1871-4573-a8b1-a6c78f73f87c"
        },
        {
            "@type": "WorkflowStep",
            "name": "Reply With Email Thread",
            "description": null,
            "arguments": {
                "resource": {
                    "cc": "{{vars.input.params.cc}}",
                    "to": "{{vars.input.records[0].from | regex_search('[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\\.[a-zA-Z0-9-.]+')}}",
                    "bcc": "{{vars.input.params.bcc}}",
                    "body": "{{vars.input.params.emailBody}}\n<br>\n<br>\n<hr>\nEmail Thread <br>\n\n{{vars.input.records[0].body}} <\/br>\n\n\n<i>--- Do Not Edit Below This Line ---<\/i><br>\nFSR {{vars.input.records[0].body | regex_search('(?<=FSR)(.*?)=*\\s(?=FSR)') | string| replace('\n', '')| replace('\t', '')| replace('\r', '') | trim }} FSR",
                    "file": "{{vars.input.params.file}}",
                    "type": "\/api\/3\/picklists\/b8e7c917-5299-4a43-9c1a-fac1d9a5438f",
                    "__link": {
                        "communications": "{{vars.input.records[0]['@id']}}"
                    },
                    "subject": "{{vars.input.records[0].subject}}",
                    "__replace": "",
                    "msgDirection": "\/api\/3\/picklists\/9f0a2594-2390-4086-9b6f-c7165c70ce27"
                },
                "_showJson": false,
                "operation": "Append",
                "collection": "\/api\/3\/communication",
                "__recommend": [],
                "fieldOperation": {
                    "recordTags": "Overwrite"
                },
                "step_variables": {
                    "new_comm_iri": "{{vars.result['@id']}}"
                }
            },
            "status": null,
            "top": "705",
            "left": "650",
            "stepType": "\/api\/3\/workflow_step_types\/2597053c-e718-44b4-8394-4d40fe26d357",
            "group": null,
            "uuid": "5a64d3c1-47ba-46ec-914e-8905e51df41b"
        },
        {
            "@type": "WorkflowStep",
            "name": "Reply Email",
            "description": null,
            "arguments": {
                "resource": {
                    "cc": "{{vars.input.params.cc}}",
                    "to": "{{vars.input.records[0].from | regex_search('[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\\.[a-zA-Z0-9-.]+')}}",
                    "bcc": "{{vars.input.params.bcc}}",
                    "body": "{{vars.input.params.emailBody}}\n\n<i>--- Do Not Edit Below This Line ---<\/i><br>\nFSR {{vars.input.records[0].body | regex_search('(?<=FSR)(.*?)=*\\s(?=FSR)') | string| replace('\n', '')| replace('\t', '')| replace('\r', '') | trim}} FSR",
                    "file": "{{vars.input.params.file}}",
                    "type": "\/api\/3\/picklists\/b8e7c917-5299-4a43-9c1a-fac1d9a5438f",
                    "__link": {
                        "communications": "{{vars.input.records[0]['@id']}}"
                    },
                    "subject": "{{vars.input.records[0].subject}}",
                    "__replace": "",
                    "msgDirection": "\/api\/3\/picklists\/9f0a2594-2390-4086-9b6f-c7165c70ce27"
                },
                "_showJson": false,
                "operation": "Append",
                "collection": "\/api\/3\/communication",
                "__recommend": [],
                "fieldOperation": {
                    "recordTags": "Overwrite"
                },
                "step_variables": {
                    "new_comm_iri": "{{vars.result['@id']}}"
                }
            },
            "status": null,
            "top": "705",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/2597053c-e718-44b4-8394-4d40fe26d357",
            "group": null,
            "uuid": "7041452c-22ed-49a1-b110-ee08ef6d695e"
        },
        {
            "@type": "WorkflowStep",
            "name": "Get Communication Correlated Records",
            "description": null,
            "arguments": {
                "query": {
                    "sort": [],
                    "limit": 30,
                    "logic": "AND",
                    "filters": [
                        {
                            "type": "primitive",
                            "field": "id",
                            "value": "{{vars.input.records[0].id}}",
                            "operator": "eq",
                            "_operator": "eq"
                        }
                    ],
                    "__selectFields": [
                        "communications"
                    ]
                },
                "module": "communication?$limit=30&$relationships=true",
                "checkboxFields": true,
                "step_variables": []
            },
            "status": null,
            "top": "165",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/b593663d-7d13-40ce-a3a3-96dece928770",
            "group": null,
            "uuid": "8bd9c4bf-83a1-4de0-9cbc-f65177339f0a"
        },
        {
            "@type": "WorkflowStep",
            "name": "Link Communication to Alert or Incident",
            "description": null,
            "arguments": {
                "when": "{{vars.iri}}",
                "params": {
                    "iri": "{{vars.iri}}",
                    "body": "{\"communications\": [\"{{vars.new_comm_iri}}\"]}"
                },
                "version": "3.2.1",
                "connector": "cyops_utilities",
                "operation": "update_cyops_resource",
                "operationTitle": "FSR: Update Record",
                "step_variables": []
            },
            "status": null,
            "top": "840",
            "left": "475",
            "stepType": "\/api\/3\/workflow_step_types\/0109f35d-090b-4a2b-bd8a-94cbc3508562",
            "group": null,
            "uuid": "9d2733d1-9416-4280-a74d-30c5ec204533"
        },
        {
            "@type": "WorkflowStep",
            "name": "Get Correlated Records IRI",
            "description": null,
            "arguments": {
                "iri": "{{vars.input.records[0].body | regex_search('(?<=FSR)(.*?)=*\\s(?=FSR)') | string| replace('\n', '')| replace('\t', '')| replace('\r', '') | trim | b64decode }}"
            },
            "status": null,
            "top": "435",
            "left": "475",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "d7c960bd-1ff3-4173-bc6c-a2d03baabdbd"
        }
    ],
    "routes": [
        {
            "@type": "WorkflowRoute",
            "name": "Get Communication Correlated Records -> Is Correlated Records Present",
            "targetStep": "\/api\/3\/workflow_steps\/46046f17-57ec-4399-826c-eacfd0a51abe",
            "sourceStep": "\/api\/3\/workflow_steps\/8bd9c4bf-83a1-4de0-9cbc-f65177339f0a",
            "label": null,
            "isExecuted": false,
            "uuid": "5d64fa0f-f6f5-4998-8de6-05d01fb5a1d8"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Reply With Email Thread -> Link Communication to Alert Incident or Task",
            "targetStep": "\/api\/3\/workflow_steps\/9d2733d1-9416-4280-a74d-30c5ec204533",
            "sourceStep": "\/api\/3\/workflow_steps\/5a64d3c1-47ba-46ec-914e-8905e51df41b",
            "label": null,
            "isExecuted": false,
            "uuid": "70cf5cf5-1c51-4abb-95b4-8b6444f92e7d"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Start -> Get Communication Correlated Records",
            "targetStep": "\/api\/3\/workflow_steps\/8bd9c4bf-83a1-4de0-9cbc-f65177339f0a",
            "sourceStep": "\/api\/3\/workflow_steps\/485a7860-1871-4573-a8b1-a6c78f73f87c",
            "label": null,
            "isExecuted": false,
            "uuid": "7169c2aa-c5a5-4974-9525-a414e7336e94"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Get Alert IRI -> Include Email Thread",
            "targetStep": "\/api\/3\/workflow_steps\/20c32266-a204-4f04-b2e1-f4db7fc0bb9f",
            "sourceStep": "\/api\/3\/workflow_steps\/d7c960bd-1ff3-4173-bc6c-a2d03baabdbd",
            "label": null,
            "isExecuted": false,
            "uuid": "7e3ca9da-7e95-4aec-9a5a-4b5b671a0284"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Reply Email -> Link Communication to Alert Incident or Task",
            "targetStep": "\/api\/3\/workflow_steps\/9d2733d1-9416-4280-a74d-30c5ec204533",
            "sourceStep": "\/api\/3\/workflow_steps\/7041452c-22ed-49a1-b110-ee08ef6d695e",
            "label": null,
            "isExecuted": false,
            "uuid": "7fc4799f-14d1-4591-84ba-d56cfcd8bb83"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Include Email Thread -> Reply Email 1",
            "targetStep": "\/api\/3\/workflow_steps\/7041452c-22ed-49a1-b110-ee08ef6d695e",
            "sourceStep": "\/api\/3\/workflow_steps\/20c32266-a204-4f04-b2e1-f4db7fc0bb9f",
            "label": "Yes",
            "isExecuted": false,
            "uuid": "8fb8d12a-3ac1-450a-9878-9d6cde9fa489"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Is Correlated Records Present -> Add Comment",
            "targetStep": "\/api\/3\/workflow_steps\/374a0d76-abe6-474c-a6b6-6c69ec401b53",
            "sourceStep": "\/api\/3\/workflow_steps\/46046f17-57ec-4399-826c-eacfd0a51abe",
            "label": "No",
            "isExecuted": false,
            "uuid": "8ff7d538-edb2-4c66-94ea-6c54fe88d64d"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Include Email Thread -> Reply With Email Thread 1",
            "targetStep": "\/api\/3\/workflow_steps\/5a64d3c1-47ba-46ec-914e-8905e51df41b",
            "sourceStep": "\/api\/3\/workflow_steps\/20c32266-a204-4f04-b2e1-f4db7fc0bb9f",
            "label": "No",
            "isExecuted": false,
            "uuid": "bca0aeb1-5e94-451d-8270-738da06887c0"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Is Correlated Records Present -> Get Correlated Records IRI",
            "targetStep": "\/api\/3\/workflow_steps\/d7c960bd-1ff3-4173-bc6c-a2d03baabdbd",
            "sourceStep": "\/api\/3\/workflow_steps\/46046f17-57ec-4399-826c-eacfd0a51abe",
            "label": "Yes",
            "isExecuted": false,
            "uuid": "c39ed83b-4a98-4827-90d4-d3348fe4b854"
        }
    ],
    "groups": [],
    "priority": null,
    "uuid": "3804ed74-4cae-410e-bdd3-23e5c5e55909",
    "owners": [],
    "isPrivate": false,
    "deletedAt": null,
    "recordTags": [
        "ManualTrigger"
    ]
}